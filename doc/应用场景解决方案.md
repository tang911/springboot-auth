支付修改状态时需要加 status = 0, 由初始状态变为终态。
组合支付积分+现金，支付回调和接口返回。


#### 1 电商平台订单未支付超时自动关单
定时任务执行 
jdk 延迟队列 delayQueue
redis 过期监听
redisson 分布式延迟队列
rocketmq 延迟队列
rabbitmq 死信队列

#### 2 如何设计一个秒杀系统
并发编程的三个核心问题: 可见性 有序性 原子性
并发的三大利器 缓存 限流 降级
架构的原则 高可用 高并发 高扩展 高负载

秒杀系统本质是一个高并发、高性能和高可用的分布式系统。
秒杀主要解决并发读和并发写的问题。
秒杀系统的院子 4要1不要
1 数据要尽量的少
2 请求要尽量的少
3 路径要尽量的短
4 依赖要尽量的少
5 不要有单点

独立的秒杀系统
动静分离
动静数据说的不是数据本身是否变动而是根据访问者的不同而其个性化数据。

缓存放在距离用户最近的位置，使用web服务器，nginx apache 
动静分离的方案：单机部署方案，统一cache层，上CDN

动静分离怎么做
流量削峰怎么做，预约抢购资格，答题，滑块验证码，兜底方案
秒杀系统怎么扣减库存

iops 系统的读写性能，系统的每秒读写次数
rt
qps
扣减库存的设计 下单扣库存 付款扣库存 预扣库存 限购模式
库存扣减通过数据库事先，需要对秒杀商品加锁，库存不能为负数。
库存扣减通过redis实现，异步写入数据库中，库存可以进一步拆分，使用redis集群分散读写压力。

#### 4 系统的QPS 突然提升10 倍
1 硬件的扩展以及微服务的拆分
2 使用高性能的RPC, Feign 带负载均衡、熔断降级的机制
3 消息队列削峰解耦
4 使用缓存架构
5 数据库分库分表
6 高可用的系统

#### 5 10W的QPS会员系统
1 ES集群实现系统查询的高可用
2 使用redis缓存数据
3 使用分库分表数据库
4 限流和降级策略

#### 6 高并发的优惠券系统
创建券模板，发放优惠券，优惠券核销与反核销，优惠券过期


#### 8 短链系统如何设计
短链生成的方法
1 单向散列函数，md5,sha, base64,截取字符
2 自增长短链
3 预生成短链模式
4 

微博分库分表策略 根据用户id 取模分库分表,设置用户每天发微博的限制数量。


#### 14 如何避免超预期的高并发压力压垮系统
限流配置文件本地配置和远程配置，远程高于本地。
1 限流方式:  全局限流 账号限流 设备限流 资源限流
2 限流算法： 固定窗口 Window，滑动窗口 Sliding Window，漏斗 Leaky Bucket，令牌桶 Token Bucket

实践中可以采用队列当做漏斗

#### 17 你设计一个支持千万级流量的架构
前端优化：减少请求次数、页面静态化、边缘计算。
前端加缓存，Cache-Control 图片请求次数 减少脚本请求次数
后端优化 基础设施层面、网络层面、架构层

rpc 框架 提升网络传输性能  选择合适的序列化方式
网络性能提升 dubbo,合适的序列化框架 Thrift Protobuf

rocketmq 发送局部有序消息，使用 producer.send 发送消息时需要实现 MessageQueueSelector 接口，自定义queue序列


SPU：标准产品单元（Standard Product Unit）
SKU：库存单位（Stock Keeping Unit
SKC：库存颜色单位（Stock Keeping Color）
SPU代表单款商品。
SKU代表单款单色单码。
SKC代表单款单色。


底层服务要抽象

#### 26 库存抢购超卖少买问题
修改库存需要携带版本信息，防止出现ABA问题



